<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Data Table</title>
    <style>
      :root {
        color-scheme: light dark;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
        background: light-dark(#f5f5f5, #000);
        padding: 20px;
      }

      .container {
        max-width: 1400px;
        margin: 0 auto;
        background: light-dark(#fff, #050505);
        border-radius: 8px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        overflow: hidden;
      }

      .search-bar {
        padding: 20px;
        border-bottom: 1px solid light-dark(#eee, #1f1f1f);
      }

      .search-input {
        width: 300px;
        padding: 10px 15px;
        border: 2px solid light-dark(#ddd, #050505);
        border-radius: 6px;
        font-size: 14px;
        outline: none;
      }

      .search-input:focus {
        border-color: light-dark(#007bff, #74c7ec);
      }

      .stats {
        margin-left: 15px;
        color: light-dark(#666, ##9ca3af);
        font-size: 14px;
      }

      .table-container {
        overflow: auto;
        max-height: calc(100vh - 140px);
      }

      table {
        width: 100%;
        border-collapse: collapse;
        font-size: 14px;
      }

      thead th {
        background: light-dark(#f8f9fa, #1f1f1f);
        padding: 12px 15px;
        text-align: left;
        font-weight: 600;
        border-bottom: 2px solid light-dark(#dee2e6, #1f1f1f);
        position: sticky;
        top: 0;
        z-index: 10;
      }

      tbody tr {
        border-bottom: 1px solid light-dark(#eee, #1f1f1f);
      }

      tbody tr:hover {
        color: #000;
        background: light-dark(#007bff, #74c7ec);
      }

      td {
        padding: 12px 15px;
        vertical-align: top;
      }

      .rank-cell {
        font-weight: 600;
        color: light-dark(#666, ##9ca3af);
        width: 60px;
      }

      .handle-cell {
        font-weight: 500;
        min-width: 150px;
        max-width: 300px;
        overflow-x: hidden;
      }

      .no-results {
        text-align: center;
        padding: 40px;
        color: light-dark(#666, ##9ca3af);
      }

      @media (max-width: 768px) {
        .search-input {
          width: 100%;
          margin-bottom: 10px;
        }

        .stats {
          margin-left: 0;
        }

        table {
          font-size: 12px;
        }

        td,
        th {
          padding: 8px 10px;
        }
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="search-bar">
        <input
          type="text"
          id="searchInput"
          class="search-input"
          placeholder="Search by handle..."
        />
        <span class="stats">
          Showing <strong id="visibleCount">0</strong> of
          <strong id="totalCount">0</strong> items
        </span>
      </div>

      <div class="table-container">
        <table id="dataTable">
          <thead id="tableHead"></thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>
    </div>

    <script>
      const DATA = __DATA_PLACEHOLDER__;

      let filteredData = [...DATA];
      let columns = [];

      const searchInput = document.getElementById("searchInput");
      const tableHead = document.getElementById("tableHead");
      const tableBody = document.getElementById("tableBody");
      const totalCount = document.getElementById("totalCount");
      const visibleCount = document.getElementById("visibleCount");

      function initializeColumns() {
        if (DATA.length === 0) return;

        const allKeys = new Set();
        DATA.forEach((item) => {
          Object.keys(item).forEach((key) => allKeys.add(key));
        });

        columns = ["#", ...Array.from(allKeys)];
      }

      function createTableHeader() {
        const headerRow = document.createElement("tr");

        columns.forEach((col) => {
          const th = document.createElement("th");
          if (col === "#") {
            th.textContent = "Rank";
            th.className = "rank-cell";
          } else {
            th.textContent = col;
          }
          headerRow.appendChild(th);
        });

        tableHead.appendChild(headerRow);
      }

      searchInput.addEventListener("input", (e) => {
        const searchTerm = e.target.value.trim();
        filterData(searchTerm);
      });

      function filterData(searchTerm) {
        if (!searchTerm) {
          filteredData = [...DATA];
        } else {
          filteredData = DATA.filter((item) => {
            const handle = item.handle || "";
            const did = item.did;
            return handle.includes(searchTerm) || did.includes(searchTerm);
          });
        }
        displayData();
      }

      function displayData() {
        tableBody.innerHTML = "";

        if (filteredData.length === 0) {
          const row = document.createElement("tr");
          const cell = document.createElement("td");
          cell.colSpan = columns.length;
          cell.className = "no-results";
          cell.textContent = "No items match your search.";
          row.appendChild(cell);
          tableBody.appendChild(row);
        } else {
          filteredData.forEach((item) => {
            const originalIndex = DATA.indexOf(item);
            const rank = originalIndex + 1;

            const row = document.createElement("tr");

            columns.forEach((col) => {
              const cell = document.createElement("td");

              if (col === "#") {
                cell.textContent = rank;
                cell.className = "rank-cell";
              } else {
                const value = item[col];
                if (col.toLowerCase() === "handle") cell.className = "handle-cell";
                cell.textContent = value;
              }

              row.appendChild(cell);
            });

            tableBody.appendChild(row);
          });
        }

        updateStats();
      }


      function updateStats() {
        totalCount.textContent = DATA.length;
        visibleCount.textContent = filteredData.length;
      }

      // Initialize the page
      document.addEventListener("DOMContentLoaded", () => {
        initializeColumns();
        createTableHeader();
        displayData();
      });
    </script>
  </body>
</html>
